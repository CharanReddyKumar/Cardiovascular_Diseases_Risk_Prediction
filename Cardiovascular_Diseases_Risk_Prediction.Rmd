---
title: "Cardiovascular_Diseases_Risk_Prediction"
output: html_document
date: "2023-10-06"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Data variables info

General_Health
Would you say that in general your health isâ€”

Checkup
About how long has it been since you last visited a doctor for a routine checkup?

Exercise
During the past month, other than your regular job, did you participate in any physical activities or exercises such as running, calisthenics, golf, gardening, or walking for exercise?

Heart_Disease
Respondents that reported having coronary heart disease or mycardialinfarction

Skin_Cancer
Respondents that reported having skin cancer

Other_Cancer
Respondents that reported having any other types of cancer

Depression
Respondents that reported having a depressive disorder (including depression, major depression, dysthymia, or minor depression)

Diabetes
Respondents that reported having a diabetes. If yes, what type of diabetes it is/was.

Arthritis
Respondents that reported having an Arthritis

Sex
Respondent's Gender

Age_Category
Height_(cm)
Weight_(kg)
BMI
Smoking_History
Alcohol_Consumption
Fruit_Consumption
Green_Vegetables_Consumption
FriedPotato_Consumption


# Import Library

```{R}
library(dplyr)
library(ggplot2)
library(tidyr)
library(skimr)
```

# Import Data

```{R}
df = read.csv('CVD.csv')
```

# Data Summary

```{R}
skim(df)
```
# Data type correction
```{R}
# Struture of the data.
str(df)


#  'Sex' to a factor
df$Sex <- factor(df$Sex)

df$General_Health <- factor(df$General_Health)
df$Checkup <- factor(df$Checkup)

#  'Age_Category' to a factor
df$Age_Category <- factor(df$Age_Category)

#  'Smoking_History' to a factor
df$Smoking_History <- factor(df$Smoking_History)

#  'Heart_Disease' to a factor
df$Heart_Disease <- factor(df$Heart_Disease)

#  'Skin_Cancer' to a factor
df$Skin_Cancer <- factor(df$Skin_Cancer)

#  'Other_Cancer' to a factor
df$Other_Cancer <- factor(df$Other_Cancer)

#  'Arthritis' to a factor
df$Arthritis <- factor(df$Arthritis)

#  'Depression' to a factor
df$Depression <- factor(df$Depression)

#  'Diabetes' to a factor
df$Diabetes <- factor(df$Diabetes)

#  'Diabetes' to a factor
df$Exercise <- factor(df$Exercise)

```
# Structure of the data after factorizing the variables
```{r structure of the data}
summary(df)
```

# Distribution of numeric variables
```{R}
# Visualization of data distribution
numerical_features <- c('Height_.cm.', 'Weight_.kg.', 'BMI', 
                        'Alcohol_Consumption', 'Fruit_Consumption', 
                        'Green_Vegetables_Consumption', 'FriedPotato_Consumption')

# Loop through the numerical features and create histograms with density plots
for (feature in numerical_features) {
  # Create a ggplot object for each feature
  plot <- ggplot(df, aes_string(x = feature)) +
    geom_histogram(binwidth = 1, fill = "blue", color = "black") +  # Create a histogram
    geom_density(aes(y = after_stat(count))) +
    ggtitle(paste("Distribution of", feature)) +
    xlab(feature) + ylab("Count") +
    theme_minimal()  # Minimal theme
    
  # Display the plot
  print(plot)
}

```


Interpretation Of Results:
Height_.cm.: The height of the patients seems to be following normal distribution with majority of patients having heights around 160 to 180cm.

Weight_.kg.: The weight of the patients also appears to be following normal distribution, with patients having weights approximately between 60kg to 100kg.

BMI : The distribution of Body Mass Index is somewhat right-skewed. A large number of patients have a BMI between 20 and 30, which falls within the normal to overweight range. However, there are also a significant number of patients with a BMI in the obese range (>30).

Alcohol_Consumption : This feature is heavily right skewed. Most patients have very low alcohol consumption, but there are few patients with high alcohol consumption as well.

Fruit_Consumption : This feature also seems to be right skewed. A lot of patients consume fruits regularly, but a significant number consume them less regularly.

Green_Vegetables_Consumption : This feature appears to be following normal distribution with most patients consuming green vegetables regularly.

FriedPotato_Consumption : This feature seems to be right skewed. Many patients consume fried potatos less frequently, while few consume them more often.


```{R}
# Define the list of categorical features
categorical_features <- c('General_Health', 'Checkup', 'Exercise', 'Heart_Disease', 
                          'Skin_Cancer', 'Other_Cancer', 'Depression', 'Diabetes', 
                          'Arthritis', 'Sex', 'Age_Category', 'Smoking_History')

# Loop through the categorical features and create count plots
for (feature in categorical_features) {
  # Create a ggplot object for each feature
  plot <- ggplot(df, aes_string(x = feature)) +
    geom_bar() +  # Create a bar plot
    ggtitle(paste("Count of", feature)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) + # Rotate x-axis labels
    geom_text(stat='count', aes(label=scales::percent(..count../sum(..count..))), 
              vjust=1.6, color="black", size=3)
  # Display the plot
  print(plot)
}

```


# Interprettation of Results:

General_Health : Most patients describe their general health as "Very Good", with "Good" being the second most response. Few patients rate their health as "Fair" and "Poor"

Checkup : Majority of the patients did checkup with in the past year. Fewer patients had their last checkup 2 years ago or more than 5 years ago.

Exercise : Most patients do exercises regularly compared to those who do not.

Heart_Disease : A significant majority of patients do not have any heart disease, only a small proportion of patients have heart disease.

Skin_Cancer : Vast majority of patients do not have skin cancer.

Other_Cancer : Similar to skin cancer, vast majority of patients do not have any kind of cancer.

Depression : Most patients do not have any depression, however small proportion of patients do report having depression.

Diabetes: Most patients do not have diabetes, which is similar to the disease-related features mentioned above. However, diabetes affects a small percentage of the population.

Arthritis: While the majority of patients do not have arthritis, a significant number do.

Sex: The dataset contains slightly more female patients than male patients.

Age_Category: Patients from a wide range of ages are included in the dataset. The age group 50-54 has the most patients, followed by the 55-59 and 60-64 age groups.

Smoking_History: The vast majority of patients have never smoked.





# Health issue - Smoking history
```{R}

# Viz Health issues and Smoking History
health_issues <- c("Heart_Disease", "Skin_Cancer", "Other_Cancer", "Arthritis")
for (issue in health_issues) {

  p = ggplot(df, aes(x = issue , fill = Smoking_History)) +
  geom_bar(position = "fill") 
    
  print(p)

}


```
# Age_Category vs. Heart_Disease
```{R}
ggplot(df, aes(x = Age_Category, fill = Heart_Disease)) +
  geom_bar(position = "fill") +
  labs(title = "Age_Category vs. Heart_Disease")

```
# Other_Cancer vs. Heart_Disease
```{R}
ggplot(df, aes(x = Other_Cancer, fill = Heart_Disease)) +
  geom_bar(position = "fill") +
  labs(title = "Other_Cancer vs. Heart_Disease")
```
# Sex vs. Heart_Disease
```{R}
ggplot(df, aes(x = Sex, fill = Heart_Disease)) +
  geom_bar(position = "fill") +
  labs(title = "Sex vs. Heart_Disease")
```
# Skin_Cancer vs. Heart_Disease
```{R}
ggplot(df, aes(x = Skin_Cancer, fill = Heart_Disease)) +
  geom_bar(position = "fill") +
  labs(title = "Skin_Cancer vs. Heart_Disease")
```
# Alcohol Consumption vs. Heart Disease

```{R}
ggplot(df, aes(x = (Heart_Disease), y = Alcohol_Consumption, fill = Heart_Disease)) +
  geom_boxplot() +
  labs(title = "Alcohol Consumption vs. Heart Disease") +
  ylab("Alcohol Consumption")
```
# BMI vs. Heart Disease
```{R}
ggplot(df, aes(x = Heart_Disease, y = BMI, fill = Heart_Disease)) +
  geom_boxplot() +
  labs(title = "BMI vs. Heart Disease") +
  ylab("BMI")
```
# Fried Potato Consumption vs. Heart Disease
```{R}
ggplot(df, aes(x = Heart_Disease, y = FriedPotato_Consumption, fill = Heart_Disease)) +
  geom_boxplot() +
  labs(title = "Fried Potato Consumption vs. Heart Disease") +
  ylab("Fried Potato Consumption")
```
# Fruit Consumption vs. Heart Disease
```{R}
ggplot(df, aes(x = factor(Heart_Disease), y = Fruit_Consumption, fill = Heart_Disease)) +
  geom_boxplot() +
  labs(title = "Fruit Consumption vs. Heart Disease") +
  ylab("Fruit Consumption")
```

# BMI - Heart Disease
```{r}
ggplot(df, aes(x = BMI, fill = Heart_Disease)) +
  geom_density(alpha = 0.5) +
  labs(title = "BMI Density by Heart_Disease", x = "BMI") +
  scale_fill_manual(values = c("No" = "blue", "Yes" = "red"))


ggplot(df, aes(x = Heart_Disease, y = BMI, fill = Heart_Disease)) +
  geom_violin() +
  labs(title = "BMI vs. Heart_Disease", x = "Heart_Disease", y = "BMI")

# Histograms of BMI by Heart_Disease
ggplot(df, aes(x = BMI, fill = Heart_Disease)) +
  geom_histogram() +
  labs(title = "Histograms of BMI by Heart_Disease", x = "BMI", y = "Frequency") +
  scale_fill_manual(values = c("No" = "blue", "Yes" = "red"))

```
# Heart_Disease vs. Smoking_History (Faceted)
```{R}
# Faceted bar plot of Heart_Disease vs. Smoking_History and Sex
ggplot(df, aes(x = Smoking_History, fill = Heart_Disease)) +
  geom_bar(position = "fill") +
  facet_grid(Sex ~ .) +
  labs(title = "Heart_Disease vs. Smoking_History (Faceted)", x = "Smoking_History", y = "Proportion") +
  scale_fill_manual(values = c("No" = "blue", "Yes" = "red"))

```
```{R}
# Explore Relationships (e.g., Heart_Disease vs. Lifestyle Factors)
health_issues <- c("Heart_Disease", "Skin_Cancer", "Other_Cancer", "Arthritis")
Life_Styles <- c("Exercise", "Sex", "Age_Category", "Height_.cm.", "Weight_.kg.", "BMI", "Smoking_History", "Alcohol_Consumption", "Fruit_Consumption", "Green_Vegetables_Consumption", "FriedPotato_Consumption")

for (issue in health_issues) {
  for (style in Life_Styles){
    p <- ggplot(df, aes(x = .data[[issue]], fill = .data[[style]])) +
      geom_bar(position = "fill") +
      labs(title = paste(issue, "vs.", style))
    print(p)
  }
}
```
```{R}
# Box Plots for numeric variables vs. Heart_Disease
boxplot_data <- df %>%
  select(Heart_Disease, Height_.cm., Weight_.kg., BMI, Fruit_Consumption, Green_Vegetables_Consumption, FriedPotato_Consumption, Alcohol_Consumption)

boxplot_data_long <- boxplot_data %>%
  pivot_longer(cols = -Heart_Disease, names_to = "Variable", values_to = "Value")

p <- ggplot(boxplot_data_long, aes(x = Heart_Disease, y = Value, fill = Heart_Disease)) +
  geom_boxplot() +
  facet_wrap(~Variable, scales = "free_y") +
  labs(title = "Numeric Variables vs. Heart_Disease")

print(p)

```
# chi-squared test between Heart_Disease and Smoking_History
```{R}


# List of categorical variables to be check for relation with Heart_Disease
categorical_variables <- c("Skin_Cancer", "Other_Cancer", "Depression", "Diabetes", "Arthritis", "Sex", "Age_Category", "Exercise", "Smoking_History","Smoking_History")

# chi-squared test for each categorical variable
for (var in categorical_variables) {
  chi_square_result <- chisq.test(df$Heart_Disease, df[[var]])
  cat("\nChi-squared Test: ", var, "vs. Heart_Disease:\n")
  print(chi_square_result)
}


### My Notes: If p value < 0.5 it indicates that both variables are significantly related
### All values are less than 0 and shows that all are significantly related (Should check the code r is it completly fine)
```

# Hypothesis Testing:

1.
a. People with smoking history have the same BMI as those without smoking history

Statement a: People with smoking history have the same BMI as those without smoking history.

Hypothesis:
Null Hypothesis (H0): The mean BMI of people with a smoking history is equal to the mean BMI of those without a smoking history. (mean1 = mean2)

Alternative Hypothesis (H1): The mean BMI of people with a smoking history is different from the mean BMI of those without a smoking history. (mean1 != mean2)

```{R}
# Statement a: Hypothesis testing for BMI and smoking
smoke_df <- df[df$Smoking_History == "Yes", "BMI"]
no_smoke_df <- df[df$Smoking_History == "No", "BMI"]

# Perform a two-sample t-test
t_test_result_smoke <- t.test(smoke_df, no_smoke_df)
print(t_test_result_smoke)
```
# Observations 
**1. A very small p-value (e.g., p-value < 0.05) indicates strong evidence against the null hypothesis. ** 

**2. Rejecting Null hypothesis**

1.

b. Female BMI is less than or equal to male BMI

Statement b: Female BMI is less than or equal to male BMI.

Hypothesis:
Null Hypothesis (H0): The mean BMI of females is less than or equal to the mean BMI of males. (mean female â‰¤ mean male)

Alternative Hypothesis (H1): The mean BMI of females is greater than the mean BMI of males. (mean female > mean male)

```{R}
# Statement b: Hypothesis testing for BMI and sex
female_df <- df[df$Sex == "Female", "BMI"]
male_df <- df[df$Sex == "Male", "BMI"]

# Perform a one-sided t-test
t_test_result <- t.test(female_df, male_df, alternative = "greater")
print(t_test_result)
```
# Observations.

**1. Failed to reject Null Hypothesis since p value is almost equal to 1**




```{R} 
# 3D Plot

library(plotly)
library(corrplot)

ds <- read.csv("CVD_cleaned.csv")
convert_age_category <- function(category) {
  if (grepl("-", category)) {
    range <- as.numeric(strsplit(category, "-")[[1]])
    avg <- mean(range)
  } else {
    avg <- as.numeric(gsub("[^0-9]", "", category))
  }
  return(avg)
}

ds$Age_Category <- sapply(ds$Age_Category, convert_age_category)

plot_3d <- plot_ly(ds, x = ~BMI, y = ~Age_Category, z = ~Heart_Disease, 
                   type = "scatter3d", mode = "markers",
                   marker = list(size = 5, color = 'green', opacity = 0.7))

plot_3d <- plot_3d %>% layout(scene = list(
  xaxis = list(title = 'BMI', backgroundcolor = "rgb(200, 200, 230)"),
  yaxis = list(title = 'Age_Category', backgroundcolor = "rgb(230, 200, 230)"),
  zaxis = list(title = 'Heart_Disease', backgroundcolor = "rgb(200, 230, 200)")
),
margin = list(l = 0, r = 0, b = 0, t = 0))

plot_3d



```







